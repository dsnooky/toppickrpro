<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Redirecting…</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="robots" content="noindex,nofollow,noarchive">
<meta http-equiv="referrer" content="no-referrer">

<style>
body{
  background:#0f2027;color:#fff;
  display:flex;align-items:center;justify-content:center;
  height:100vh;margin:0;text-align:center;
  font-family:Arial,Helvetica,sans-serif
}
.loader{
  width:40px;height:40px;
  border:4px solid rgba(255,255,255,.3);
  border-top:4px solid #ffeb3b;
  border-radius:50%;
  animation:spin 1s linear infinite;
  margin:20px auto
}
@keyframes spin{to{transform:rotate(360deg)}}
</style>
</head>

<body>

<div>
  <h2>Redirecting to partner store…</h2>
  <div class="loader"></div>
</div>

<script>
const SHEET_URL = "PUT_YOUR_CSV_URL_HERE";
const params = new URLSearchParams(location.search);
const id = params.get("id");
const platform = params.get("p");

function parseCSV(row){
  const out=[];let cur="",q=false;
  for(let i=0;i<row.length;i++){
    const c=row[i];
    if(c=='"'&&row[i+1]=='"'){cur+='"';i++}
    else if(c=='"'){q=!q}
    else if(c==","&&!q){out.push(cur);cur=""}
    else cur+=c;
  }
  out.push(cur);
  return out.map(x=>x.replace(/^"|"$/g,"").trim());
}

fetch(SHEET_URL,{cache:"no-store"})
  .then(r=>r.text())
  .then(csv=>{
    const rows = csv.trim().split("\n").slice(1);
    for(const r of rows){
      const [pid,title,category,shopee,lazada] = parseCSV(r);
      if(pid===id){
        let target = platform==="Lazada" ? lazada : shopee;
        if(!target) target = shopee || lazada;
        if(target){
          setTimeout(()=>location.replace(target),300);
          return;
        }
      }
    }
    document.body.innerHTML="Invalid link.";
  });
</script>

</body>
</html>
